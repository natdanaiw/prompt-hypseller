function validateInput(){var t=$("#amount").val();0>t&&(alert("โปรดระบุจำนวนเงินมากกว่าหรือเท่ากับ 0 เท่านั้น"),$("#amount").val("0.00"))}function fixDiv(){var t=$("#left_control,#right_control");$(window).scrollTop()>100?t.css({position:"fixed",top:"10px"}):t.css({position:"absolute",top:"auto"})}function generateQR(){var t=$("#amount").val(),e=$("#account").val(),a=generatePayload(e,{amount:parseFloat(t)}),i=$("#size").val(),o={render:"canvas",text:a,background:"#ffffff",size:i,radius:0,quiet:"1",mode:0};""!=e&&null!=e&&$("#container").empty().qrcode(o)}function generateOutput(){generateQR();var t=$("#size").val(),e=new Image(t,t);e.onload=drawImageActualSize,e.src=$("#src_img").attr("src")}function onImageInput(){var t=$("#image_file")[0];if(t.files&&t.files[0])if(t.files.length<=40){var e=new FileReader;e.onload=function(t){$("#src_img").attr("src",t.target.result),generateOutput()},e.readAsDataURL(t.files[0]),$("#image_list").empty(),$("#image_list").css("display","block"),$("#image_list").append('<label for="img_list">รูปทั้งหมด</label><br>');for(var a=0;a<t.files.length;a++){var i=new FileReader;i.onload=function(t){var e='<div class="select_image" onclick="loadImage(this);">';e+='<img id="img_'+a+'" src="'+t.target.result+'" width="65" height="65" />',e+="</div>",e+="<br>",$("#image_list").append(e)},i.readAsDataURL(t.files[a])}}else alert("ระบบอนุญาตให้แก้ไขรูปได้ครั้งละ 5 รูปเท่านั้น")}function loadImage(t){var e=$(t).find("img");$("#src_img").attr("src",$(e).attr("src")),generateOutput()}function drawImageActualSize(){var t=document.getElementById("output_canvas"),e=t.getContext("2d"),a=$("#container canvas")[0],i=5,o=this.width/150,l=50*o,n=45*o,r=new Image(l,n);if(r.src=$("#promptpay_logo").attr("src"),t.width=.5*this.naturalWidth,t.height=.5*this.naturalHeight,e.drawImage(this,0,0,t.width,t.height),null!=a){var c,s,d,h,u,g;switch(qr_layout){case"top-l":g=$("#show_amount").is(":checked")?30:15,h=g+5,s=h+n,c=i,d=c,u=c+15;break;case"top-r":g=$("#show_amount").is(":checked")?30:15,h=g+5,s=h+n,c=t.width-this.width-i,d=c,u=c+15;break;case"bottom-l":c=i,s=t.height-this.height-i,d=c,h=s-n,u=c+15,g=h-5;break;case"bottom-r":c=t.width-this.width-i,s=t.height-this.height-i,d=c,h=s-n,u=c+15,g=h-5}e.drawImage(a,c,s,this.width,this.height),e.drawImage(r,d,h,this.width,n);var m=15*o;e.font=m+"px bold ubuntu",$("#show_amount").is(":checked")?(e.fillStyle="white",e.fillRect(c,g-m,this.width,m+5),e.fillRect(c,g-2*m,this.width,m+5),e.fillStyle="grey",e.fillText($("#receiver").val(),u,g-m),e.fillText($("#amount").val()+" บาท",u,g+2)):(e.fillStyle="white",e.fillRect(c,g-m,this.width,m+5),e.fillStyle="grey",e.fillText($("#receiver").val(),u,g)),e.restore(),$(".button").css("background-color","#666660"),$("#"+qr_layout).css("background-color","#1D89AA"),$("#download").css("display","block"),$("#download").attr("href",t.toDataURL("image/png")),$("#download").attr("download","download.png")}else $("#download,#print").css("display","none")}var qr_layout="bottom-l";$(document).ready(function(){$("#select_image").css("display","block"),$("#select_image").click(function(){$("#image_file").trigger("click")}),$("#image_file").on("change",onImageInput),$("#receiver,#account,#amount,#size,#show_amount").change(function(){validateInput(),generateOutput()}),$("#amount").keypress(function(t){46==t.which&&-1==$(this).val().indexOf(".")||!(t.which<48||t.which>57)||t.preventDefault()}),$(".button").click(function(){qr_layout=$(this).attr("id"),generateOutput()}),$("#print").click(function(){var t=document.getElementById("output_canvas"),e="<!DOCTYPE html>";e+="<html>",e+="<head><title>Print canvas</title></head>",e+="<body>",e+='<img src="'+t.toDataURL("image/png")+'">',e+="</body>",e+="</html>";var a=window.open("","","width=340,height=260");a.document.open(),a.document.write(e),a.document.close(),a.focus(),a.print(),a.close()}),$(window).scroll(fixDiv),fixDiv()});